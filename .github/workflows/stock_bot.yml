name: è‚¡ç¥¨åˆ†ææœºå™¨äºº ğŸ¤–

# ============================================================================
# GitHub Repository Secrets é…ç½®è¯´æ˜
# ============================================================================
# è¯·åœ¨ GitHub Repository Settings > Secrets and variables > Actions ä¸­é…ç½®ä»¥ä¸‹å˜é‡ï¼š
#
# 1. TELEGRAM_BOT_TOKEN
#    è¯´æ˜: Telegram Bot Token
#    è·å–æ–¹å¼: é€šè¿‡ @BotFather åˆ›å»ºæœºå™¨äººåè·å–
#    ç¤ºä¾‹: 123456789:ABCdefGHIjklMNOpqrsTUVwxyz
#
# 2. TELEGRAM_CHAT_ID
#    è¯´æ˜: Telegram Chat IDï¼ˆæ¥æ”¶æ¶ˆæ¯çš„èŠå¤©IDï¼‰
#    è·å–æ–¹å¼: é€šè¿‡ @userinfobot æˆ– @getidsbot è·å–
#    ç¤ºä¾‹: 123456789
#
# 3. GDRIVE_CREDENTIALS
#    è¯´æ˜: Google Drive æœåŠ¡è´¦å· JSON å‡­è¯ï¼Œå­˜åŸå§‹ JSON å…¨æ–‡ï¼ˆå‹¿ base64ï¼‰
#    è·å–æ–¹å¼:
#       a) åœ¨ Google Cloud Console åˆ›å»ºæœåŠ¡è´¦å·ï¼Œä¸‹è½½ JSON å¯†é’¥æ–‡ä»¶
#       b) ç”¨ç¼–è¾‘å™¨æ‰“å¼€ credentials.jsonï¼Œå¤åˆ¶æ•´ä¸ªå†…å®¹
#       c) ç²˜è´´åˆ° GDRIVE_CREDENTIALSï¼Œä¿æŒåˆæ³• JSONï¼ˆå¯å«æ¢è¡Œï¼‰
#    ç¤ºä¾‹: {"type":"service_account","project_id":"..."}
#
# 4. GDRIVE_FOLDER_ID
#    è¯´æ˜: Google Drive ç›®æ ‡æ–‡ä»¶å¤¹ IDï¼ˆæ”¯æŒåä½œäº‘ç«¯ç¡¬ç›˜æˆ–ä¸ªäººæ–‡ä»¶å¤¹ï¼‰
#    è·å–æ–¹å¼: åœ¨ Drive ä¸­æ‰“å¼€è¯¥æ–‡ä»¶å¤¹ï¼Œä» URL çš„ folders/xxx æå– ID
#    ç¤ºä¾‹: 1a2b3c4d5e6f7g8h9i0j
#
# 5. GDRIVE_OWNER_EMAILï¼ˆå¯é€‰ï¼Œæ¨èè®¾ç½®ï¼‰
#    è¯´æ˜: ä¸ªäºº Google è´¦å·é‚®ç®±ï¼Œç”¨äºæ¥æ”¶ä¸Šä¼ æ–‡ä»¶çš„æ‰€æœ‰æƒ
#    é€‚ç”¨åœºæ™¯: ä½¿ç”¨ä¸ªäººæ–‡ä»¶å¤¹ï¼ˆéåä½œäº‘ç«¯ç¡¬ç›˜ï¼‰æ—¶ï¼Œä¸Šä¼ åè‡ªåŠ¨æ·»åŠ æ­¤é‚®ç®±ä¸ºç¼–è¾‘è€…
#    è·å–æ–¹å¼: ä½ çš„ Google è´¦å·é‚®ç®±
#    ç¤ºä¾‹: noahfanye@gmail.com
#
# æ³¨æ„äº‹é¡¹:
# - GDRIVE_CREDENTIALS å­˜åŸå§‹ JSONï¼Œä¸è¦ base64 ç¼–ç 
# - æ–‡ä»¶å¤¹é…ç½®ï¼ˆäºŒé€‰ä¸€ï¼‰ï¼š
#   æ–¹æ¡ˆ1 - åä½œäº‘ç«¯ç¡¬ç›˜ï¼ˆæ¨èï¼Œæ— å­˜å‚¨é™åˆ¶ï¼‰ï¼š
#     æ–°å»ºåä½œäº‘ç«¯ç¡¬ç›˜ â†’ åœ¨ç›˜å†…å»ºæ–‡ä»¶å¤¹ â†’ ç®¡ç†æˆå‘˜æ·»åŠ  client_email ä¸ºã€Œå†…å®¹ç®¡ç†å‘˜ã€
#   â†’ ç”¨è¯¥æ–‡ä»¶å¤¹ ID ä½œä¸º GDRIVE_FOLDER_ID
#   æ–¹æ¡ˆ2 - ä¸ªäººæ–‡ä»¶å¤¹ï¼ˆéœ€è®¾ç½® GDRIVE_OWNER_EMAILï¼‰ï¼š
#     åœ¨ã€Œæˆ‘çš„äº‘ç«¯ç¡¬ç›˜ã€åˆ›å»ºæ–‡ä»¶å¤¹ â†’ å…±äº«ç»™æœåŠ¡è´¦å·ä¸ºã€Œç¼–è¾‘è€…ã€
#   â†’ è®¾ç½® GDRIVE_OWNER_EMAIL ä¸ºä½ çš„ä¸ªäººé‚®ç®± â†’ ä¸Šä¼ åä¼šè‡ªåŠ¨æ·»åŠ ä½ ä¸ºç¼–è¾‘è€…
# - ç¡®ä¿å·²å¯ç”¨ Google Drive API
# ============================================================================

on:
  schedule:
    # äº¤æ˜“æ—¥åˆç›˜ä¸æ”¶ç›˜ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰
    # Aè‚¡ï¼š11:30 / 15:00ï¼›æ¸¯è‚¡ï¼š12:00 / 16:00
    # è§¦å‘æ—¶é—´åŠ  5 åˆ†é’Ÿç¼“å†²
    - cron: '35 3 * * 1-5'  # 11:35
    - cron: '5 4 * * 1-5'   # 12:05
    - cron: '5 7 * * 1-5'   # 15:05
    - cron: '10 8 * * 1-5'  # 16:10
  workflow_dispatch:
    inputs:
      stocks:
        description: 'è¾“å…¥è‚¡ç¥¨ä»£ç ï¼ˆæ”¯æŒAè‚¡å’Œæ¸¯è‚¡ï¼Œå¦‚ï¼š600460,00700ï¼‰'
        required: false
        default: '688630,600460,300474,300623,300019'

jobs:
  analyze-stocks:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    permissions:
      contents: read
    steps:
    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v4

    - name: è®¾ç½®Pythonç¯å¢ƒ
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
        cache: 'pip'

    - name: å®‰è£…ä¾èµ–
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements-core.txt -r requirements-optional.txt
        pip install pytz
        sudo apt-get update
        sudo apt-get install -y fonts-wqy-zenhei

    - name: è¿è¡Œè‚¡ç¥¨åˆ†æ
      id: run_analysis
      timeout-minutes: 25
      continue-on-error: true
      env:
        DATABASE_ENABLED: "false"
      run: |
        # ä¸´æ—¶ç¦ç”¨æ•°æ®åº“ï¼šæŠ¥å‘Šåªç”¨æ¥å£å®æ—¶æ•°æ®ï¼Œä¸è¯»ä¸å†™æœ¬åœ° DB
        export TZ='Asia/Shanghai'
        # è®°å½•è¿è¡Œå¼€å§‹æ—¶é—´
        export RUN_START_TIME=$(date +%s)
        echo "RUN_START_TIME=$RUN_START_TIME" >> $GITHUB_ENV
        echo "è¿è¡Œå¼€å§‹æ—¶é—´: $(date) (Timestamp: $RUN_START_TIME)"
        
        STOCKS="${{ github.event.inputs.stocks }}"
        if [ -z "$STOCKS" ]; then
          STOCKS="688630,600460,300474,300623,300019"
        fi
        STOCKS="${STOCKS//,/ }"
        STOCKS="${STOCKS//ï¼Œ/ }"
        STOCKS="$(echo "$STOCKS" | xargs)"
        # ä½¿ç”¨ manual æ¨¡å¼ï¼Œè¿™æ ·è„šæœ¬åªç®¡ç”Ÿæˆ PDFï¼Œä¸ä¼šæŠ¥é”™ä¹Ÿä¸ä¼šé‡å¤å‘æ¶ˆæ¯
        python github_stock_bot.py --mode manual --stocks "$STOCKS"
        
        # æ£€æŸ¥æ˜¯å¦æœ‰PDFæ–‡ä»¶ç”Ÿæˆï¼ˆç›´æ¥ç»Ÿè®¡PDFæ–‡ä»¶ï¼‰
        PDF_COUNT=$(python3 -c "
        import os
        import glob
        run_start = int(os.environ.get('RUN_START_TIME', 0))
        # æŸ¥æ‰¾æœ€æ–°æŠ¥å‘Šæ–‡ä»¶å¤¹
        report_dirs = glob.glob('reports/reports_*')
        if not report_dirs:
            print(0)
            exit()
        latest_dir = max(report_dirs, key=os.path.getmtime)
        # åªç»Ÿè®¡åœ¨è¿è¡Œå¼€å§‹ååˆ›å»ºçš„PDFæ–‡ä»¶ï¼ˆå…è®¸60ç§’è¯¯å·®ï¼‰
        pdf_paths = glob.glob(os.path.join(latest_dir, '*.pdf'))
        pdf_paths = [p for p in pdf_paths if os.path.isfile(p) and os.path.getmtime(p) >= run_start - 60]
        print(len(pdf_paths))
        ")
        echo "æœ¬æ¬¡è¿è¡Œç”Ÿæˆçš„PDFæ•°é‡: $PDF_COUNT"
        echo "PDF_COUNT=$PDF_COUNT" >> $GITHUB_OUTPUT
        
        # ä¿å­˜æŠ¥å‘Šç›®å½•è·¯å¾„ä¾›åç»­æ­¥éª¤ä½¿ç”¨
        REPORT_DIR=$(python3 -c "
        import os
        import glob
        run_start = int(os.environ.get('RUN_START_TIME', 0))
        report_dirs = glob.glob('reports/reports_*')
        if report_dirs:
            latest_dir = max(report_dirs, key=os.path.getmtime)
            print(os.path.abspath(latest_dir))
        ")
        echo "REPORT_DIR=$REPORT_DIR" >> $GITHUB_ENV
        echo "æŠ¥å‘Šç›®å½•: $REPORT_DIR"
    
    - name: å‘é€æŠ¥å‘Šåˆ° Telegramï¼ˆå¤šæ–‡ä»¶æ¨é€ï¼‰ğŸš€
      if: steps.run_analysis.outcome == 'success' && steps.run_analysis.outputs.PDF_COUNT > 0
      run: |
        REPORT_DIR="${{ env.REPORT_DIR }}"
        if [ -z "$REPORT_DIR" ] || [ ! -d "$REPORT_DIR" ]; then
          echo "âŒ æŠ¥å‘Šç›®å½•ä¸å­˜åœ¨: $REPORT_DIR"
          exit 1
        fi
        
        TELEGRAM_TOKEN="${{ secrets.TELEGRAM_BOT_TOKEN }}"
        TELEGRAM_CHAT_ID="${{ secrets.TELEGRAM_CHAT_ID }}"
        
        if [ -z "$TELEGRAM_TOKEN" ] || [ -z "$TELEGRAM_CHAT_ID" ]; then
          echo "âŒ Telegramé…ç½®ç¼ºå¤±ï¼Œè¯·æ£€æŸ¥secrets: TELEGRAM_BOT_TOKEN, TELEGRAM_CHAT_ID"
          exit 1
        fi
        
        # ç»Ÿè®¡PDFæ–‡ä»¶æ•°é‡
        PDF_FILES=("$REPORT_DIR"/*.pdf)
        PDF_COUNT=${#PDF_FILES[@]}
        
        if [ $PDF_COUNT -eq 0 ]; then
          echo "âš ï¸ æœªæ‰¾åˆ°PDFæ–‡ä»¶"
          exit 1
        fi
        
        echo "ğŸ“¤ å¼€å§‹å‘é€ $PDF_COUNT ä¸ªPDFæ–‡ä»¶åˆ°Telegram..."
        
        SUCCESS_COUNT=0
        FAIL_COUNT=0
        
        # å¾ªç¯å‘é€æ¯ä¸ªPDFæ–‡ä»¶
        for pdf_file in "$REPORT_DIR"/*.pdf; do
          if [ ! -f "$pdf_file" ]; then
            continue
          fi
          
          FILENAME=$(basename "$pdf_file")
          FILE_SIZE=$(stat -f%z "$pdf_file" 2>/dev/null || stat -c%s "$pdf_file" 2>/dev/null || echo "0")
          FILE_SIZE_MB=$((FILE_SIZE / 1024 / 1024))
          
          # Telegram Bot API æ–‡ä»¶å¤§å°é™åˆ¶ä¸º 50MB
          if [ $FILE_SIZE_MB -gt 50 ]; then
            echo "âš ï¸ è·³è¿‡æ–‡ä»¶ $FILENAME (å¤§å°: ${FILE_SIZE_MB}MBï¼Œè¶…è¿‡50MBé™åˆ¶)"
            FAIL_COUNT=$((FAIL_COUNT + 1))
            continue
          fi
          
          echo "ğŸ“„ æ­£åœ¨å‘é€: $FILENAME (${FILE_SIZE_MB}MB)..."
          
          # å‘é€æ–‡ä»¶åˆ°Telegram
          RESPONSE=$(curl -s -w "\n%{http_code}" -X POST \
            -F "chat_id=$TELEGRAM_CHAT_ID" \
            -F "document=@$pdf_file" \
            "https://api.telegram.org/bot$TELEGRAM_TOKEN/sendDocument" 2>&1)
          
          HTTP_CODE=$(echo "$RESPONSE" | tail -n1)
          BODY=$(echo "$RESPONSE" | sed '$d')
          
          if [ "$HTTP_CODE" = "200" ]; then
            echo "âœ… æˆåŠŸå‘é€: $FILENAME"
            SUCCESS_COUNT=$((SUCCESS_COUNT + 1))
          else
            echo "âŒ å‘é€å¤±è´¥: $FILENAME (HTTP $HTTP_CODE)"
            echo "å“åº”: $BODY"
            FAIL_COUNT=$((FAIL_COUNT + 1))
          fi
          
          # é¿å…è¯·æ±‚è¿‡å¿«ï¼Œæ·»åŠ çŸ­æš‚å»¶è¿Ÿ
          sleep 1
        done
        
        echo ""
        echo "ğŸ“Š å‘é€å®Œæˆç»Ÿè®¡:"
        echo "  âœ… æˆåŠŸ: $SUCCESS_COUNT"
        echo "  âŒ å¤±è´¥: $FAIL_COUNT"
        echo "  ğŸ“„ æ€»è®¡: $PDF_COUNT"
        
        # å‘é€å®Œæˆé€šçŸ¥
        if [ $SUCCESS_COUNT -gt 0 ]; then
          curl -s -X POST \
            -F "chat_id=$TELEGRAM_CHAT_ID" \
            -F "text=âœ… Felixï¼Œæœºå™¨äººå·²å®Œæˆè‚¡ç¥¨åˆ†ææŠ¥å‘Šæ¨é€ï¼ˆæˆåŠŸ: $SUCCESS_COUNT/$PDF_COUNTï¼‰" \
            "https://api.telegram.org/bot$TELEGRAM_TOKEN/sendMessage" > /dev/null
        fi
        
        # å¦‚æœæœ‰å¤±è´¥çš„æ–‡ä»¶ï¼Œé€€å‡ºç ä¸º1
        if [ $FAIL_COUNT -gt 0 ]; then
          exit 1
        fi

    - name: ä¸Šä¼ æŠ¥å‘Šåˆ° Google Drive ğŸ“
      if: steps.run_analysis.outcome == 'success' && steps.run_analysis.outputs.PDF_COUNT > 0
      env:
        GDRIVE_CREDENTIALS: ${{ secrets.GDRIVE_CREDENTIALS }}
        GDRIVE_FOLDER_ID: ${{ secrets.GDRIVE_FOLDER_ID }}
        GDRIVE_OWNER_EMAIL: ${{ secrets.GDRIVE_OWNER_EMAIL }}
        REPORT_DIR: ${{ env.REPORT_DIR }}
      run: |
        pip install -q google-auth google-api-python-client
        python - << 'PY'
        import os
        import json
        import glob
        from google.oauth2.service_account import Credentials
        from googleapiclient.discovery import build
        from googleapiclient.http import MediaFileUpload

        report_dir = os.environ["REPORT_DIR"]
        raw = os.environ.get("GDRIVE_CREDENTIALS", "").strip()
        folder_id = os.environ.get("GDRIVE_FOLDER_ID", "").strip()
        owner_email = os.environ.get("GDRIVE_OWNER_EMAIL", "").strip()
        if not raw or not folder_id:
            raise SystemExit("ç¼ºå°‘ GDRIVE_CREDENTIALS æˆ– GDRIVE_FOLDER_ID")

        creds_dict = json.loads(raw)
        creds = Credentials.from_service_account_info(creds_dict, scopes=["https://www.googleapis.com/auth/drive"])
        drive = build("drive", "v3", credentials=creds)
        sa_email = creds_dict.get("client_email", "æœªçŸ¥")

        # ä¸Šä¼ å‰æ ¡éªŒï¼šæ–‡ä»¶å¤¹æ˜¯å¦å­˜åœ¨ä¸”å·²ä¸æœåŠ¡è´¦å·å…±äº«ï¼ˆæ”¯æŒåä½œäº‘ç«¯ç¡¬ç›˜å’Œä¸ªäººæ–‡ä»¶å¤¹ï¼‰
        try:
            folder_info = drive.files().get(fileId=folder_id, fields="id,name", supportsAllDrives=True).execute()
            print(f"ğŸ“ ç›®æ ‡æ–‡ä»¶å¤¹: {folder_info.get('name', folder_id)}")
        except Exception as e:
            err = str(e)
            if "404" in err or "notFound" in err or "not found" in err.lower():
                raise SystemExit(
                    "Google Drive æ–‡ä»¶å¤¹ä¸å­˜åœ¨æˆ–æœªä¸æœåŠ¡è´¦å·å…±äº«ã€‚\n"
                    "è¯·ï¼š1) ç¡®è®¤ GDRIVE_FOLDER_ID æ­£ç¡®ï¼›2) åœ¨ Drive ä¸­å³é”®è¯¥æ–‡ä»¶å¤¹ â†’ å…±äº« â†’ "
                    f"æ·»åŠ æ­¤é‚®ç®±å¹¶è®¾ä¸ºã€Œç¼–è¾‘è€…ã€ï¼š\n  {sa_email}"
                ) from e
            raise

        pdfs = sorted(glob.glob(os.path.join(report_dir, "*.pdf")))
        if not pdfs:
            raise SystemExit("æœªæ‰¾åˆ° PDF æ–‡ä»¶")

        from googleapiclient.errors import HttpError

        for path in pdfs:
            name = os.path.basename(path)
            # ç¡®ä¿ parents å’Œ supportsAllDrives æ­£ç¡®è®¾ç½®
            meta = {"name": name, "parents": [folder_id]}
            assert "parents" in meta and len(meta["parents"]) > 0, "ä¸Šä¼ é¡»æŒ‡å®š parentsï¼ˆç›®æ ‡æ–‡ä»¶å¤¹ IDï¼‰"
            media = MediaFileUpload(path, mimetype="application/pdf", resumable=True)
            try:
                # ä¸Šä¼ æ–‡ä»¶ï¼ˆä½¿ç”¨ supportsAllDrives=True æ”¯æŒåä½œäº‘ç«¯ç¡¬ç›˜å’Œä¸ªäººæ–‡ä»¶å¤¹ï¼‰
                f = drive.files().create(
                    body=meta,
                    media_body=media,
                    fields="id,name,owners",
                    supportsAllDrives=True,
                ).execute()
                file_id = f.get("id")
                print(f"  âœ… ä¸Šä¼ æˆåŠŸ: {name} -> {file_id}")
                
                # å¦‚æœæŒ‡å®šäº†ä¸ªäººé‚®ç®±ï¼Œå°è¯•å°†æ–‡ä»¶æ‰€æœ‰æƒè½¬ç§»ç»™ä¸ªäººè´¦å·
                if owner_email:
                    try:
                        # å…ˆæ·»åŠ ä¸ªäººé‚®ç®±ä¸ºç¼–è¾‘è€…
                        permission = {
                            "type": "user",
                            "role": "writer",
                            "emailAddress": owner_email,
                        }
                        drive.permissions().create(
                            fileId=file_id,
                            body=permission,
                            fields="id",
                            sendNotificationEmail=False,
                            supportsAllDrives=True,
                        ).execute()
                        print(f"    âœ“ å·²æ·»åŠ  {owner_email} ä¸ºç¼–è¾‘è€…")

                        # å…ˆå°è¯•ç›´æ¥è½¬ç§»æ‰€æœ‰æƒ
                        try:
                            owner_permission = {
                                "type": "user",
                                "role": "owner",
                                "emailAddress": owner_email,
                            }
                            drive.permissions().create(
                                fileId=file_id,
                                body=owner_permission,
                                fields="id",
                                sendNotificationEmail=False,
                                transferOwnership=True,
                                supportsAllDrives=True,
                            ).execute()
                            print(f"    âœ“ å·²å°è¯•è½¬ç§»æ‰€æœ‰æƒç»™ {owner_email}")
                        except Exception as transfer_err:
                            # è½¬ç§»æ‰€æœ‰æƒå¯èƒ½å¤±è´¥ï¼ˆæœåŠ¡è´¦å·å¯èƒ½æ²¡æœ‰æƒé™ï¼‰ï¼Œä½†ä¸å½±å“æ–‡ä»¶ä¸Šä¼ 
                            print(f"    âš ï¸  æ‰€æœ‰æƒè½¬ç§»å¤±è´¥ï¼ˆä¸å½±å“ä½¿ç”¨ï¼‰: {transfer_err}")
                    except Exception as perm_err:
                        # æƒé™è®¾ç½®å¤±è´¥ä¸å½±å“æ–‡ä»¶ä¸Šä¼ ï¼Œä»…è®°å½•è­¦å‘Š
                        print(f"    âš ï¸  æƒé™è®¾ç½®å¤±è´¥ï¼ˆæ–‡ä»¶å·²ä¸Šä¼ ï¼‰: {perm_err}")
                
            except HttpError as e:
                if e.resp.status == 404 and "fileId" in str(e):
                    raise SystemExit(
                        "ä¸Šä¼ å¤±è´¥ï¼šç›®æ ‡æ–‡ä»¶å¤¹ä¸å¯è®¿é—® (404)ã€‚è¯·ç¡®è®¤ï¼š\n"
                        "1) GDRIVE_FOLDER_ID æ­£ç¡®ï¼›2) å·²å°†æ–‡ä»¶å¤¹å…±äº«ç»™æœåŠ¡è´¦å·ï¼š\n  "
                        f"{sa_email}\nï¼ˆå³é”®æ–‡ä»¶å¤¹ â†’ å…±äº« â†’ æ·»åŠ ä¸Šè¿°é‚®ç®±ä¸ºç¼–è¾‘è€…ï¼‰"
                    ) from e
                if e.resp.status == 403:
                    err_str = str(e)
                    if "storageQuotaExceeded" in err_str or "storage quota" in err_str.lower():
                        raise SystemExit(
                            "ä¸Šä¼ å¤±è´¥ï¼šæœåŠ¡è´¦å·æ— å­˜å‚¨é…é¢ (403)ã€‚\n"
                            "è§£å†³æ–¹æ¡ˆï¼ˆäºŒé€‰ä¸€ï¼‰ï¼š\n"
                            "æ–¹æ¡ˆ1 - ä½¿ç”¨åä½œäº‘ç«¯ç¡¬ç›˜ï¼š\n"
                            "  1) æ–°å»ºåä½œäº‘ç«¯ç¡¬ç›˜ï¼›2) åœ¨ç›˜å†…å»ºæ–‡ä»¶å¤¹ï¼›3) ç®¡ç†æˆå‘˜æ·»åŠ  "
                            f"{sa_email} ä¸ºã€Œå†…å®¹ç®¡ç†å‘˜ã€ï¼›4) ç”¨è¯¥æ–‡ä»¶å¤¹ ID ä½œä¸º GDRIVE_FOLDER_ID\n"
                            "æ–¹æ¡ˆ2 - ä½¿ç”¨ä¸ªäººæ–‡ä»¶å¤¹ï¼ˆå·²è‡ªåŠ¨å°è¯•è½¬ç§»æ‰€æœ‰æƒï¼‰ï¼š\n"
                            "  1) ç¡®ä¿æ–‡ä»¶å¤¹å·²å…±äº«ç»™æœåŠ¡è´¦å·ä¸ºã€Œç¼–è¾‘è€…ã€ï¼›\n"
                            "  2) åœ¨ GitHub Secrets ä¸­è®¾ç½® GDRIVE_OWNER_EMAIL ä¸ºä½ çš„ä¸ªäººé‚®ç®±ï¼ˆå¦‚ noahfanye@gmail.comï¼‰ï¼›\n"
                            "  3) æ–‡ä»¶ä¸Šä¼ åä¼šè‡ªåŠ¨æ·»åŠ ä½ çš„é‚®ç®±ä¸ºç¼–è¾‘è€…ï¼Œä½ å¯ä»¥åœ¨ Drive ä¸­æ‰‹åŠ¨è½¬ç§»æ‰€æœ‰æƒ"
                        ) from e
                    raise SystemExit(
                        f"ä¸Šä¼ å¤±è´¥ï¼šæƒé™ä¸è¶³ (403)ã€‚è¯·ç¡®è®¤ï¼š\n"
                        f"1) æ–‡ä»¶å¤¹å·²å…±äº«ç»™æœåŠ¡è´¦å· {sa_email} ä¸ºã€Œç¼–è¾‘è€…ã€ï¼›\n"
                        f"2) å¦‚æœä½¿ç”¨ä¸ªäººæ–‡ä»¶å¤¹ï¼Œè¯·åœ¨ Secrets ä¸­è®¾ç½® GDRIVE_OWNER_EMAIL"
                    ) from e
                raise
        print(f"\nğŸ“Š å…±ä¸Šä¼  {len(pdfs)} ä¸ªæ–‡ä»¶")
        PY
