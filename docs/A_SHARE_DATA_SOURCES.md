# A股数据源说明

## 📊 当前数据源（免费）

系统使用多个免费数据源获取A股数据，自动降级，无需任何API密钥。

### 数据源优先级（自动降级）

```
1. 新浪财经（主要）
   ↓ (失败)
2. 新浪财经备用接口（json_v2）
   ↓ (失败)
3. 东方财富
   ↓ (失败)
4. 腾讯财经（仅日线）
   ↓ (失败)
5. AKShare（若已安装）
   ↓ (失败)
6. 1分钟数据：使用模拟生成方法
```

## 📝 各数据源支持情况

### 1. 新浪财经
- ✅ 日线：稳定支持
- ✅ 30分钟：支持
- ✅ 5分钟：支持
- ❌ 1分钟：接口已失效（"Service not valid"）

### 2. 东方财富
- ✅ 日线：稳定支持
- ✅ 30分钟：支持
- ✅ 5分钟：支持
- ❌ 1分钟：不支持

### 3. 腾讯财经
- ✅ 日线：支持（接口可能变更）
- ❌ 分钟线：不支持

### 4. AKShare（可选）
- ✅ 日线：支持
- ✅ 30分钟：支持
- ✅ 5分钟：支持
- ✅ 1分钟：支持（如果接口可用）

**安装方法：**
```bash
pip install akshare
```

### 5. 1分钟数据替代方案
当所有数据源的1分钟接口都不可用时，系统会：
1. 获取最近5天的日线数据
2. 基于日线数据模拟生成1分钟数据
3. 保持价格区间和成交量分布合理

## 🔄 自动降级示例

```python
from src.data.fetchers import fetch_kline_data

# 自动尝试所有数据源
df = fetch_kline_data('sh600460', scale=240, datalen=100)

# 如果新浪财经失败，会自动尝试：
# 1. 新浪财经备用接口
# 2. 东方财富
# 3. 腾讯财经（仅日线）
# 4. AKShare（如果已安装）
```

## ✅ 使用示例

```bash
# A股分析（自动使用最佳可用数据源）
python3 github_stock_bot.py --mode manual --stocks "600460 300474"
```

## 📊 数据源对比

| 数据源 | 日线 | 30分钟 | 5分钟 | 1分钟 | 稳定性 | 速度 |
|--------|------|--------|-------|-------|--------|------|
| 新浪财经 | ✅ | ✅ | ✅ | ❌ | ⭐⭐⭐⭐ | 快 |
| 东方财富 | ✅ | ✅ | ✅ | ❌ | ⭐⭐⭐⭐ | 快 |
| 腾讯财经 | ✅ | ❌ | ❌ | ❌ | ⭐⭐⭐ | 中 |
| AKShare | ✅ | ✅ | ✅ | ✅ | ⭐⭐⭐ | 中 |

## 🔧 故障排查

如果数据获取失败：

1. **检查网络连接**
   ```bash
   ping quotes.sina.cn
   ping quote.eastmoney.com
   ```

2. **检查接口状态**
   - 新浪财经：https://quotes.sina.cn/
   - 东方财富：https://quote.eastmoney.com/

3. **尝试安装AKShare**
   ```bash
   pip install akshare
   ```

4. **查看详细日志**
   程序会输出每个数据源的尝试结果

## 📝 注意事项

1. **免费接口限制**
   - 所有数据源都是免费接口，可能有访问频率限制
   - 建议在请求之间添加适当延迟

2. **数据准确性**
   - 不同数据源的数据可能有细微差异
   - 建议优先使用新浪财经或东方财富

3. **1分钟数据**
   - 如果所有接口都不可用，会使用模拟生成方法
   - 模拟数据基于日线数据，仅供参考
