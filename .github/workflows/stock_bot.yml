name: è‚¡ç¥¨åˆ†ææœºå™¨äºº ğŸ¤–

on:
  workflow_dispatch:
    inputs:
      stocks:
        description: 'è‚¡ç¥¨ä»£ç '
        required: false
        default: '600460 300474 300623 300420'
  schedule:
    - cron: '30 7 * * 1-5'

jobs:
  analyze-stocks:
    runs-on: ubuntu-latest
    steps:
    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v4
    - name: è®¾ç½®Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.9'
    - name: å®‰è£…ä¾èµ–
      run: |
        pip install requests pandas numpy reportlab akshare matplotlib pytz
        sudo apt-get update
        sudo apt-get install -y fonts-wqy-zenhei
    
    - name: è¿è¡Œè‚¡ç¥¨åˆ†æ
      env:
        TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
      run: |
        export TZ='Asia/Shanghai'
        # æ ¸å¿ƒä¿®æ­£ï¼šæ·»åŠ  --force æ ‡å¿—ï¼Œç»•è¿‡ä»£ç é‡Œçš„äº¤æ˜“æ—¶é—´æ£€æŸ¥
        python github_stock_bot.py --mode telegram --stocks '600460 300474 300623 300420' --force

    - name: ä¸Šä¼ åˆ†ææŠ¥å‘Š
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: stock-reports-${{ github.run_id }}
        # é‡‡ç”¨æœ€å®½æ³›çš„åŒ¹é…æ¨¡å¼ï¼ŒæŠ“å–ä»»ä½•ç”Ÿæˆçš„ PDF å’Œ ZIP
        path: |
          **/*.pdf
          **/*.zip
